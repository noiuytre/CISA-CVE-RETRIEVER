param (
    [string]$CVE
)
# Check if $CVE is provided
if (-not $CVE) {
    Write-Host "Please provide a CVE as a parameter."
    exit
}
elseif ($CVE) {
    $CVE = $CVE.ToUpper()
}
# Define the URL
$url = "https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json"


# Make the web request and get the JSON response
$response = Invoke-RestMethod -Uri $url -Method Get
# Check if the response contains data
if ($response.title -eq "CISA Catalog of Known Exploited Vulnerabilities") {
    #Write-Host $response.vulnerabilities
    # Loop through the list of vulnerabilities
    foreach ($vulnerability in $response.vulnerabilities) {
        #Write-Host $vulnerability.cveID
        if ($vulnerability.cveID -eq $CVE) {
                #retrieve information
                $cveID = $vulnerability.cveID
                $vendorProject = $vulnerability.vendorProject
                $product = $vulnerability.product
                $vulnerabilityName = $vulnerability.vulnerabilityName
                $dateAdded = $vulnerability.dateAdded
                $shortDescription = $vulnerability.shortDescription
                $requiredAction = $vulnerability.requiredAction
                $dueDate = $vulnerability.dueDate
                $knownRansomwareCampaignUse = $vulnerability.knownRansomwareCampaignUse
                $notes = $vulnerability.notes

                # Output the parsed data
                Write-Host "CVE ID: $cveID"
                Write-Host "Vendor project: $vendorProject"
                Write-Host "Product: $product"
                Write-Host "Vulnerability name: $vulnerabilityName"
                Write-Host "Date added: $dateAdded"
                Write-Host "Short description: $shortDescription"
                Write-Host "Required action: $requiredAction"
                Write-Host "Due date: $dueDate"
                Write-Host "Known ransomware campaign: $knownRansomwareCampaignUse"
                if($notes){
                    Write-Host "Notes: $notes"

                }
        }
    }
}else {
    Write-Host "Error: Unable to retrieve CVE information. /or/ No CVE found."
}    

